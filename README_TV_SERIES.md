# 📺 电视剧AI剪辑系统使用说明

## 🎯 核心功能

本系统专为电视剧多集处理设计，满足您提出的所有需求：

### ✅ 已实现的功能

1. **100% AI分析** - 完全由AI驱动，无法分析则直接返回
2. **完整剧情理解** - 一次性分析整集字幕，不会割裂剧情
3. **智能剪辑点识别** - AI自动识别3-8个精彩片段
4. **对话完整性保证** - 剪辑时保证句子完整，不在中间截断
5. **旁观者叙述** - 为每个片段生成第三人称旁白字幕
6. **跨集连贯性** - 自动处理集与集之间的衔接
7. **缓存机制** - AI分析结果缓存，避免重复调用API
8. **断点续传** - 已剪辑的视频不会重复剪辑
9. **结果一致性** - 多次执行相同字幕文件得到一致结果

## 📁 目录结构

```
clip-main/
├── srt/              # 放置字幕文件（.srt）
├── videos/           # 放置视频文件（.mp4, .mkv等）
├── tv_clips/         # 输出：剪辑后的视频片段
├── tv_cache/         # 缓存：AI分析结果
├── tv_analysis/      # 输出：分析报告
└── clean_main.py     # 主程序入口
```

## 🚀 快速开始

### 1. 准备文件

将字幕文件放入 `srt/` 目录：
```
srt/
├── 第01集.srt
├── 第02集.srt
├── 第03集.srt
└── ...
```

将对应视频文件放入 `videos/` 目录：
```
videos/
├── 第01集.mp4
├── 第02集.mp4
├── 第03集.mp4
└── ...
```

### 2. 配置AI接口

运行程序：
```bash
python clean_main.py
```

选择 `1. 🤖 配置AI接口`

#### 选项A：官方API（Gemini）
- 选择 `1. 🔒 官方API`
- 输入Gemini API密钥
- 选择模型（推荐：gemini-2.5-flash）

#### 选项B：中转API（OpenAI兼容）
- 选择 `2. 🌐 中转API`
- 选择中转服务或自定义
- 输入API密钥和模型名称

### 3. 开始剪辑

选择 `3. 📺 电视剧AI剪辑`

然后选择处理模式：
- `1. 📺 处理所有集数` - 自动处理所有字幕文件
- `2. 🎯 选择特定集数` - 手动选择要处理的集数

## 📊 输出文件说明

处理完成后，每个精彩片段会生成3个文件：

### 1. 视频文件
```
第01集_片段01_关键冲突_abc12345.mp4
```
- 剪辑后的视频片段
- 文件名包含集数、片段序号、标题和哈希值

### 2. 旁白字幕
```
第01集_片段01_关键冲突_abc12345_旁白.srt
```
- 旁观者视角的叙述字幕
- 分为开场、发展、高潮、结尾四段
- 可以用播放器加载到视频上

### 3. 分析报告
```
第01集_片段01_关键冲突_abc12345_分析报告.txt
```
- 详细的AI分析报告
- 包含精彩原因、关键时刻、剧情联系等

## 🔄 工作流程

```
1. 解析字幕 → 智能修正错别字
2. AI分析 → 识别精彩片段（检查缓存）
3. 查找视频 → 自动匹配视频文件
4. 剪辑视频 → 创建片段（跳过已存在）
5. 生成字幕 → 旁观者叙述
6. 生成报告 → 详细分析
7. 保存衔接 → 用于下一集
```

## 💡 使用技巧

### 缓存机制
- AI分析结果会自动缓存在 `tv_cache/` 目录
- 相同字幕文件多次运行会使用缓存，节省API调用
- 如需重新分析，删除对应的缓存文件即可

### 断点续传
- 已剪辑的视频会自动跳过
- 可以随时中断，下次继续处理
- 确保多次执行结果一致

### 跨集连贯性
- 系统会自动记录每集的衔接信息
- 下一集分析时会参考上一集的内容
- 确保整个剧情连贯

## ⚙️ 高级配置

### 修改AI提示词
编辑 `tv_ai_analyzer.py` 中的 `_build_analysis_prompt` 方法

### 调整剪辑参数
编辑 `tv_video_clipper.py` 中的 FFmpeg参数

### 自定义字幕格式
编辑 `tv_subtitle_generator.py` 中的 `_build_srt_content` 方法

## 🐛 常见问题

### Q: AI分析失败怎么办？
A: 检查API配置是否正确，确保网络连接正常

### Q: 找不到视频文件？
A: 确保视频文件名与字幕文件名相似，系统会自动模糊匹配

### Q: 如何重新分析某一集？
A: 删除 `tv_cache/` 目录中对应的缓存文件

### Q: 剪辑失败怎么办？
A: 确保安装了FFmpeg，并且视频文件格式正确

## 📝 注意事项

1. **API稳定性** - AI分析结果会自动缓存，避免重复调用
2. **视频格式** - 支持mp4, mkv, avi, mov等常见格式
3. **字幕编码** - 自动检测utf-8, gbk, gb2312等编码
4. **磁盘空间** - 确保有足够空间存储剪辑后的视频

## 🎉 完成！

现在您可以开始使用电视剧AI剪辑系统了！

如有问题，请检查：
1. AI配置是否正确
2. 字幕和视频文件是否放在正确目录
3. FFmpeg是否已安装
4. 网络连接是否正常
